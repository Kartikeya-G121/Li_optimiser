<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Creator Dashboard</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Clash+Display:wght@400;500;600&family=Cabinet+Grotesk:wght@400;500;600&display=swap");

      :root {
        --purple-600: #9333ea;
        --purple-700: #7e22ce;
        --font-primary: "Clash Display", sans-serif;
        --font-secondary: "Cabinet Grotesk", sans-serif;
      }

      body {
        font-family: var(--font-secondary);
        line-height: 1.6;
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
        background-color: white;
      }

      .sidebar {
        width: 250px;
        background-color: #f3f4f6;
        border-right: 1px solid #e5e7eb;
        padding: 20px;
      }

      .sidebar h1 {
        font-family: var(--font-primary);
        font-weight: 600;
        letter-spacing: -0.02em;
        font-size: 28px;
        color: var(--purple-600);
        margin-bottom: 20px;
      }

      .sidebar-nav {
        display: flex;
        flex-direction: column;
      }

      .sidebar-nav button {
        background: none;
        border: none;
        text-align: left;
        padding: 10px;
        margin-bottom: 5px;
        cursor: pointer;
        color: #4b5563;
        transition: background-color 0.3s;
        font-family: var(--font-secondary);
        font-weight: 500;
        letter-spacing: 0.01em;
        font-size: 15px;
      }

      .sidebar-nav button:hover,
      .sidebar-nav button.active {
        background-color: #e9d5ff;
        color: var(--purple-600);
      }

      .main-content {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
      }

      .card {
        background-color: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .stat-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .stat-card {
        background-color: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .stat-card h3 {
        font-family: var(--font-secondary);
        font-size: 14px;
        font-weight: 500;
        letter-spacing: 0.02em;
        color: #6b7280;
        margin: 0;
      }

      .stat-card p {
        font-size: 24px;
        font-weight: bold;
        margin: 10px 0 0;
        color: #111827;
      }

      button {
        background-color: var(--purple-600);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: var(--purple-700);
      }

      input,
      textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
      }

      .content-section {
        display: none;
      }

      .content-section.active {
        display: block;
      }

      /* New styles for post generation */
      .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin: 15px 0;
      }

      .ai-button {
        display: flex;
        align-items: center;
        gap: 8px;
        background-color: var(--purple-600);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .ai-button:hover {
        background-color: var(--purple-700);
        transform: translateY(-1px);
      }

      .generated-content {
        background-color: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 4px;
        padding: 15px;
        min-height: 100px;
        margin: 15px 0;
        white-space: pre-wrap;
      }

      .post-stats {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        color: #6b7280;
      }

      #generationStatus {
        color: #6b7280;
      }

      .secondary-button {
        background-color: white;
        color: var(--purple-600);
        border: 1px solid var(--purple-600);
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      .secondary-button:hover {
        background-color: #f3f4f6;
      }

      .chat-window {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin: 15px 0;
      }

      .chat-history {
        max-height: 200px;
        overflow-y: auto;
        padding: 10px;
        background-color: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 4px;
      }

      .chat-message {
        margin-bottom: 10px;
        padding: 8px 12px;
        border-radius: 8px;
        max-width: 80%;
      }

      .user-message {
        background-color: var(--purple-600);
        color: white;
        margin-left: auto;
      }

      .ai-message {
        background-color: #e5e7eb;
        color: #111827;
        margin-right: auto;
      }

      .chat-input-container {
        display: flex;
        gap: 10px;
      }

      .chat-input {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #e5e7eb;
        border-radius: 4px;
        font-size: 14px;
      }

      .chat-send {
        padding: 10px 15px;
        min-width: 44px;
      }

      .editable {
        border: 1px solid #e5e7eb;
        padding: 15px;
        border-radius: 4px;
        background-color: white;
        min-height: 100px;
      }

      .editable:focus {
        outline: 2px solid var(--purple-600);
        border-color: transparent;
      }

      h2 {
        font-family: var(--font-primary);
        font-weight: 500;
        letter-spacing: -0.01em;
        font-size: 24px;
        margin-bottom: 1.5rem;
      }

      h3 {
        font-family: var(--font-primary);
        font-weight: 500;
        letter-spacing: -0.01em;
        font-size: 20px;
      }

      .subtitle {
        color: #6b7280;
        font-family: var(--font-secondary);
        margin-bottom: 24px;
      }

      .idea-input-card {
        background: white;
        padding: 24px;
        margin-bottom: 32px;
      }

      .idea-input-card textarea {
        width: 100%;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        font-family: var(--font-secondary);
        font-size: 15px;
        margin-bottom: 16px;
        resize: none;
      }

      .generate-button {
        background-color: var(--purple-600);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-family: var(--font-secondary);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .generate-button:hover {
        background-color: var(--purple-700);
        transform: translateY(-1px);
      }

      .ideas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
      }

      .idea-card {
        background: white;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
      }

      .idea-card h3 {
        font-family: var(--font-primary);
        font-size: 18px;
        margin-bottom: 12px;
        color: #111827;
      }

      .idea-text {
        color: #4b5563;
        font-family: var(--font-secondary);
        font-size: 15px;
        line-height: 1.6;
        margin-bottom: 20px;
      }

      .idea-actions {
        display: flex;
        gap: 12px;
      }

      .use-button {
        background-color: var(--purple-600);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-family: var(--font-secondary);
        font-weight: 500;
        font-size: 14px;
      }

      .save-button {
        background-color: white;
        color: var(--purple-600);
        border: 1px solid var(--purple-600);
        padding: 8px 16px;
        border-radius: 6px;
        font-family: var(--font-secondary);
        font-weight: 500;
        font-size: 14px;
      }

      .save-button:hover {
        background-color: #f3f4f6;
      }

      .saved-ideas-section {
        margin-top: 40px;
        padding-top: 32px;
        border-top: 1px solid #e5e7eb;
      }

      .saved-ideas-section h2 {
        font-family: var(--font-primary);
        font-size: 24px;
        margin-bottom: 24px;
        color: #111827;
      }

      .saved-ideas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
      }

      .saved-idea-card {
        background: white;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        position: relative;
      }

      .saved-idea-card h3 {
        font-family: var(--font-primary);
        font-size: 18px;
        margin-bottom: 12px;
        color: #111827;
      }

      .saved-idea-text {
        color: #4b5563;
        font-family: var(--font-secondary);
        font-size: 15px;
        line-height: 1.6;
        margin-bottom: 20px;
      }

      .delete-button {
        position: absolute;
        top: 16px;
        right: 16px;
        background: none;
        border: none;
        color: #ef4444;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .delete-button:hover {
        background-color: #fee2e2;
      }

      .no-saved-ideas {
        text-align: center;
        padding: 32px;
        color: #6b7280;
        font-family: var(--font-secondary);
        background: #f9fafb;
        border-radius: 12px;
        border: 1px dashed #e5e7eb;
      }

      .toast-message {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: var(--purple-600);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-family: var(--font-secondary);
        font-size: 14px;
        animation: slideIn 0.3s ease, slideOut 0.3s ease 1.7s;
        z-index: 1000;
      }

      .delete-button {
        position: absolute;
        top: 16px;
        right: 16px;
        background: none;
        border: none;
        color: #ef4444;
        cursor: pointer;
        padding: 8px;
        border-radius: 4px;
        transition: all 0.2s ease;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
      }

      .delete-button:hover {
        background-color: #fee2e2;
      }

      .saved-idea-card {
        transition: all 0.3s ease;
      }

      .saved-idea-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      .saved-idea-card .use-button {
        background-color: var(--purple-600);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-family: var(--font-secondary);
        font-weight: 500;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .saved-idea-card .use-button:hover {
        background-color: var(--purple-700);
        transform: translateY(-1px);
      }

      .calendar-section {
        padding: 24px;
        background: white;
        border-radius: 12px;
        margin-bottom: 24px;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .calendar-nav-btn {
        background: none;
        border: 1px solid var(--purple-600);
        color: var(--purple-600);
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .calendar-nav-btn:hover {
        background-color: var(--purple-600);
        color: white;
      }

      .calendar-weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        font-weight: 500;
        color: #6b7280;
        margin-bottom: 12px;
      }

      .calendar-days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
      }

      .calendar-day {
        aspect-ratio: 1;
        padding: 8px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .calendar-day:hover {
        border-color: var(--purple-600);
        background-color: #f3e8ff;
      }

      .calendar-day.has-post {
        background-color: #f3e8ff;
        border-color: var(--purple-600);
      }

      .calendar-day.today {
        background-color: var(--purple-600);
        color: white;
      }

      .post-indicator {
        position: absolute;
        bottom: 4px;
        right: 4px;
        width: 6px;
        height: 6px;
        background-color: var(--purple-600);
        border-radius: 50%;
      }

      .schedule-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-width: 500px;
        width: 90%;
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        backdrop-filter: blur(4px);
      }

      .time-selector {
        margin: 16px 0;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .time-selector label {
        font-family: var(--font-secondary);
        color: #4b5563;
        font-size: 14px;
      }

      .time-input {
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-family: var(--font-secondary);
        color: #111827;
        width: 120px;
      }

      .schedule-textarea {
        width: 100%;
        margin: 16px 0;
        padding: 12px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        resize: vertical;
        font-family: var(--font-secondary);
        font-size: 14px;
        line-height: 1.6;
      }

      .modal-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .button-group {
        display: flex;
        gap: 8px;
      }

      .calendar-day {
        min-height: 80px;
        padding: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
      }

      .post-time {
        font-size: 10px;
        color: var(--purple-600);
        margin-top: 4px;
        font-weight: 500;
      }

      .toast-message {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: var(--purple-600);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-family: var(--font-secondary);
        font-size: 14px;
        animation: slideIn 0.3s ease, slideOut 0.3s ease 1.7s;
        z-index: 1000;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      .schedule-modal {
        background: white;
        padding: 24px;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
      }

      .time-selector {
        margin: 20px 0;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .time-input {
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-family: var(--font-secondary);
        width: 120px;
        font-size: 14px;
      }

      .post-content {
        margin: 20px 0;
      }

      .post-content label {
        display: block;
        margin-bottom: 8px;
        color: #4b5563;
        font-size: 14px;
      }

      .schedule-textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        resize: vertical;
        font-family: var(--font-secondary);
        font-size: 14px;
        line-height: 1.6;
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        margin-top: 24px;
      }

      .cancel-button,
      .schedule-button {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .cancel-button {
        background: white;
        border: 1px solid #e5e7eb;
        color: #6b7280;
      }

      .schedule-button {
        background: var(--purple-600);
        border: none;
        color: white;
      }

      .schedule-button:hover {
        background: var(--purple-700);
      }

      .calendar-day {
        min-height: 80px;
        padding: 8px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .calendar-day.has-post {
        background-color: #f3e8ff;
        border-color: var(--purple-600);
      }

      .calendar-day.today {
        background-color: var(--purple-600);
        color: white;
      }

      .post-indicator {
        width: 6px;
        height: 6px;
        background-color: var(--purple-600);
        border-radius: 50%;
        position: absolute;
        bottom: 4px;
        right: 4px;
      }

      .post-time {
        font-size: 10px;
        color: var(--purple-600);
        margin-top: 4px;
        font-weight: 500;
      }

      .toast-message {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: var(--purple-600);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-family: var(--font-secondary);
        font-size: 14px;
        animation: slideIn 0.3s ease, slideOut 0.3s ease 1.7s;
        z-index: 1000;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  </head>
  <body>
    <div class="sidebar">
      <h1>Creator Hub</h1>
      <nav class="sidebar-nav">
        <button class="nav-button active" data-target="home">Home</button>
        <button class="nav-button" data-target="idea-generation">
          Idea Generation
        </button>
        <button class="nav-button" data-target="post-creation">
          Post Creation
        </button>
        <button class="nav-button" data-target="content-calendar">
          Content Calendar
        </button>
        <button class="nav-button" data-target="profile-optimization">
          Profile Optimization
        </button>
      </nav>
    </div>

    <div class="main-content">
      <div id="home" class="content-section active">
        <h2>Welcome back, Creator!</h2>
        <div class="stat-cards">
          <div class="stat-card">
            <h3>Post Ideas</h3>
            <p>12</p>
          </div>
          <div class="stat-card">
            <h3>Scheduled Posts</h3>
            <p>5</p>
          </div>
          <div class="stat-card">
            <h3>Profile Score</h3>
            <p>85%</p>
          </div>
        </div>
        <div class="card">
          <h3>Quick Actions</h3>
          <button>Generate New Idea</button>
          <button>Create Post</button>
          <button>View Calendar</button>
          <button>Optimize Profile</button>
        </div>
      </div>

      <div id="idea-generation" class="content-section">
        <h2>AI Ideas Generator ✨</h2>
        <p class="subtitle">
          Get instant inspiration! Just enter a post topic below and watch the
          magic happening.
        </p>

        <div class="idea-input-card card">
          <textarea
            id="ideaInput"
            placeholder="Write your topic here"
            rows="4"
          ></textarea>
          <button onclick="generateIdeas()" class="generate-button">
            <span class="icon">✨</span> Generate
          </button>
        </div>

        <div class="ideas-grid">
          <div class="idea-card card">
            <h3>Idea #1</h3>
            <p class="idea-text"></p>
            <div class="idea-actions">
              <button onclick="useIdea(this)" class="use-button">Use</button>
              <button onclick="saveIdea(this)" class="save-button">Save</button>
            </div>
          </div>
          <!-- Repeat for ideas 2-4 -->
        </div>

        <div class="saved-ideas-section">
          <h2>Saved Ideas 💡</h2>
          <div class="saved-ideas-grid">
            <!-- Saved ideas will be populated here -->
          </div>
        </div>
      </div>

      <div id="post-creation" class="content-section">
        <h2>Post Creation</h2>
        <div class="card">
          <textarea
            id="postInput"
            placeholder="Write your ideas here... (e.g., 'Tech productivity tips for remote workers', 'Benefits of AI in healthcare')"
            rows="5"
          ></textarea>

          <div class="button-group">
            <button
              onclick="generateWithLlama('professional')"
              class="ai-button"
            >
              <span class="ai-icon">🤖</span>Professional Tone
            </button>
            <button onclick="generateWithLlama('casual')" class="ai-button">
              <span class="ai-icon">🤖</span>Casual Tone
            </button>
            <button onclick="generateWithLlama('funny')" class="ai-button">
              <span class="ai-icon">🤖</span>Humorous Tone
            </button>
            <button onclick="generateWithLlama('viral')" class="ai-button">
              <span class="ai-icon">🤖</span>Viral Style
            </button>
          </div>
        </div>
        <div class="card">
          <h3>Generated Post & Refinement</h3>
          <div class="chat-window">
            <div id="chatHistory" class="chat-history">
              <!-- Chat messages will appear here -->
            </div>

            <div
              id="generatedPost"
              class="generated-content editable"
              contenteditable="true"
            >
              Your AI-generated post will appear here...
            </div>

            <div class="chat-input-container">
              <input
                type="text"
                id="refinementInput"
                class="chat-input"
                placeholder="Ask AI to modify the post (e.g., 'Make it shorter', 'Add more emojis')"
              />
              <button onclick="refinePost()" class="ai-button chat-send">
                <span class="ai-icon">↑</span>
              </button>
            </div>
          </div>
          <div class="post-stats">
            <div id="generationStatus"></div>
            <span id="charCount">0/3000 characters</span>
            <button onclick="copyToClipboard()" class="secondary-button">
              Copy Post
            </button>
            <button onclick="scheduleGeneratedPost()" class="secondary-button">
              Schedule Post
            </button>
          </div>
        </div>
      </div>

      <div id="content-calendar" class="content-section">
        <h2>Content Calendar</h2>
        <div class="calendar-section card">
          <div class="calendar-header">
            <button onclick="previousMonth()" class="calendar-nav-btn">
              ←
            </button>
            <h3 id="currentMonth">November 2024</h3>
            <button onclick="nextMonth()" class="calendar-nav-btn">→</button>
          </div>

          <div class="calendar-weekdays">
            <div>SUN</div>
            <div>MON</div>
            <div>TUE</div>
            <div>WED</div>
            <div>THU</div>
            <div>FRI</div>
            <div>SAT</div>
          </div>

          <div id="calendarDays" class="calendar-days"></div>
        </div>

        <div class="scheduled-posts card">
          <h3>Scheduled Posts</h3>
          <div id="scheduledPostsList">
            <!-- Scheduled posts will appear here -->
          </div>
        </div>
      </div>

      <div id="profile-optimization" class="content-section">
        <h2>LinkedIn Profile Analyzer</h2>

        <!-- Upload Section -->
        <div class="card" style="text-align: center; padding: 40px">
          <div
            id="dropZone"
            style="
              border: 2px dashed #e5e7eb;
              border-radius: 8px;
              padding: 40px;
              margin-bottom: 20px;
              cursor: pointer;
            "
          >
            <img
              src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTM2IDQySDEyQzEwLjQwODcgNDIgOC44ODI1OCA0MS4zNjc5IDcuNzU3MzYgNDAuMjQyNkM2LjYzMjE0IDM5LjExNzQgNiAzNy41OTEzIDYgMzZWMTJDNiAxMC40MDg3IDYuNjMyMTQgOC44ODI1OCA3Ljc1NzM2IDcuNzU3MzZDOC44ODI1OCA2LjYzMjE0IDEwLjQwODcgNiAxMiA2SDM2QzM3LjU5MTMgNiAzOS4xMTc0IDYuNjMyMTQgNDAuMjQyNiA3Ljc1NzM2QzQxLjM2NzkgOC44ODI1OCA0MiAxMC40MDg3IDQyIDEyVjM2QzQyIDM3LjU5MTMgNDEuMzY3OSAzOS4xMTc0IDQwLjI0MjYgNDAuMjQyNkMzOS4xMTc0IDQxLjM2NzkgMzcuNTkxMyA0MiAzNiA0MloiIHN0cm9rZT0iIzkzMzNFQSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPHBhdGggZD0iTTE4IDI0TDI0IDE4TDMwIDI0IiBzdHJva2U9IiM5MzMzRUEiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+CjxwYXRoIGQ9Ik0yNCAzNlYxOCIgc3Ryb2tlPSIjOTMzM0VBIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K"
              alt="Upload"
              style="width: 48px; margin-bottom: 16px"
            />
            <p>Drag & drop your LinkedIn PDF here or click to upload</p>
            <input
              type="file"
              id="pdfInput"
              accept=".pdf"
              style="display: none"
            />
            <button
              class="choose-file-btn"
              onclick="document.getElementById('pdfInput').click()"
              style="
                background-color: var(--purple-600);
                color: white;
                padding: 12px 24px;
                border-radius: 6px;
                border: none;
                margin-top: 16px;
                cursor: pointer;
              "
            >
              Choose File
            </button>
          </div>
        </div>

        <!-- Analysis Results -->
        <div id="analysisResult" class="card" style="display: none">
          <div style="text-align: center; margin-bottom: 32px">
            <h3>Profile Analysis Score</h3>
            <div
              style="
                width: 120px;
                height: 120px;
                background: var(--purple-600);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 24px;
                margin: 20px auto;
              "
            >
              <span id="profileScore">0</span>/100
            </div>
          </div>

          <div>
            <h3>Improvement Suggestions</h3>
            <ul
              id="suggestionsList"
              style="list-style: none; padding: 0; margin: 0"
            ></ul>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const currentUser = sessionStorage.getItem('currentUser');
        if (!currentUser) {
          window.location.href = 'auth.html';
          return;
        }

        // Optional: Add logout functionality
        const logoutButton = document.createElement('button');
        logoutButton.textContent = 'Logout';
        logoutButton.onclick = function() {
          sessionStorage.removeItem('currentUser');
          localStorage.removeItem('currentUser');
          window.location.href = 'auth.html';
        };
        document.body.appendChild(logoutButton);
      });

      // Define API_KEY globally so it's accessible to all functions
      const API_KEY ="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";

      // Navigation functionality
      document.addEventListener("DOMContentLoaded", function () {
        const navButtons = document.querySelectorAll(".nav-button");
        const contentSections = document.querySelectorAll(".content-section");

        navButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const target = this.getAttribute("data-target");

            navButtons.forEach((btn) => btn.classList.remove("active"));
            this.classList.add("active");

            contentSections.forEach((section) => {
              section.classList.remove("active");
              if (section.id === target) {
                section.classList.add("active");
              }
            });
          });
        });
      });

      // Post generation functionality
      async function generateWithLlama(tone) {
        const input = document.getElementById("postInput").value.trim();
        const statusElement = document.getElementById("generationStatus");
        const generatedPost = document.getElementById("generatedPost");

        if (!input) {
          alert("Please write some ideas first!");
          return;
        }

        // Show generating status
        statusElement.innerHTML = "🤖 Generating...";
        generatedPost.textContent = "Generating your post...";

        const prompts = {
          professional: `Create a professional and formal social media post based on these ideas: "${input}". Use business-appropriate language and maintain a professional tone.`,
          casual: `Write a casual and friendly social media post based on these ideas: "${input}". Make it conversational and relatable.`,
          funny: `Create a humorous and entertaining social media post based on these ideas: "${input}". Include witty remarks and keep it light-hearted.`,
          viral: `Transform these ideas into a viral-style social media post: "${input}". Make it attention-grabbing and shareable. Include trending elements.`,
        };

        try {
          const response = await fetch(
            "https://api.groq.com/openai/v1/chat/completions",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${API_KEY}`,
              },
              body: JSON.stringify({
                model: "llama3-70b-8192",
                messages: [
                  {
                    role: "user",
                    content: prompts[tone],
                  },
                ],
                temperature: 0.7,
                max_tokens: 1000,
              }),
            }
          );

          if (!response.ok) {
            throw new Error("Generation failed");
          }

          const data = await response.json();
          const generatedText = data.choices[0].message.content.trim();

          generatedPost.textContent = generatedText;
          statusElement.innerHTML = "✅ Generated";
          updateCharCount(generatedText.length);
        } catch (error) {
          console.error("Error:", error);
          statusElement.innerHTML = "❌ Generation failed";
          generatedPost.textContent =
            "Sorry, there was an error generating your post. Please try again.";
        }
      }

      function updateCharCount(count) {
        document.getElementById(
          "charCount"
        ).textContent = `${count}/3000 characters`;
      }

      function copyToClipboard() {
        const generatedPost =
          document.getElementById("generatedPost").textContent;
        navigator.clipboard
          .writeText(generatedPost)
          .then(() => {
            alert("Post copied to clipboard!");
          })
          .catch((err) => {
            console.error("Failed to copy text: ", err);
          });
      }

      // Character counter for input
      document
        .getElementById("postInput")
        ?.addEventListener("input", function () {
          const charCount = this.value.length;
          updateCharCount(charCount);
        });

      async function refinePost() {
        const refinementInput = document.getElementById("refinementInput");
        const chatHistory = document.getElementById("chatHistory");
        const currentPost = document.getElementById("generatedPost");
        const instruction = refinementInput.value.trim();

        if (!instruction) return;

        // Add user message to chat
        addMessageToChat("user", instruction);

        // Clear input
        refinementInput.value = "";

        try {
          const response = await fetch(
            "https://api.groq.com/openai/v1/chat/completions",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${API_KEY}`,
              },
              body: JSON.stringify({
                model: "llama3-70b-8192",
                messages: [
                  {
                    role: "system",
                    content:
                      "You are a helpful AI assistant that helps refine social media posts. Provide direct edits without explanations unless asked.",
                  },
                  {
                    role: "user",
                    content: `Current post: "${currentPost.textContent}"\n\nInstruction: ${instruction}`,
                  },
                ],
                temperature: 0.7,
                max_tokens: 1000,
              }),
            }
          );

          if (!response.ok) throw new Error("Refinement failed");

          const data = await response.json();
          const refinedText = data.choices[0].message.content.trim();

          // Add AI response to chat
          addMessageToChat("ai", "Here's the refined version:");

          // Update the post
          currentPost.textContent = refinedText;
          updateCharCount(refinedText.length);
        } catch (error) {
          console.error("Error:", error);
          addMessageToChat(
            "ai",
            "Sorry, I encountered an error while refining the post."
          );
        }
      }

      function addMessageToChat(role, message) {
        const chatHistory = document.getElementById("chatHistory");
        const messageDiv = document.createElement("div");
        messageDiv.className = `chat-message ${role}-message`;
        messageDiv.textContent = message;
        chatHistory.appendChild(messageDiv);
        chatHistory.scrollTop = chatHistory.scrollHeight;
      }

      // Add Enter key support for the chat input
      document
        .getElementById("refinementInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            refinePost();
          }
        });

      async function generateIdeas() {
        const input = document.getElementById("ideaInput").value.trim();
        const ideasGrid = document.querySelector(".ideas-grid");

        if (!input) {
          alert("Please enter a topic first!");
          return;
        }

        // Clear existing cards and show loading state
        ideasGrid.innerHTML = "";
        for (let i = 0; i < 4; i++) {
          ideasGrid.innerHTML += `
                    <div class="idea-card card">
                        <h3>Idea #${i + 1}</h3>
                        <p class="idea-text">Generating idea...</p>
                        <div class="idea-actions">
                            <button onclick="useIdea(this)" class="use-button">Use</button>
                            <button onclick="saveIdea(this)" class="save-button">Save</button>
                        </div>
                    </div>
                `;
        }

        try {
          const response = await fetch(
            "https://api.groq.com/openai/v1/chat/completions",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${API_KEY}`,
              },
              body: JSON.stringify({
                model: "llama3-8b-8192",
                messages: [
                  {
                    role: "system",
                    content:
                      "You are a creative AI that generates unique content ideas. Generate engaging, specific titles that would work well as social media posts or articles.",
                  },
                  {
                    role: "user",
                    content: `Generate 4 unique, creative content ideas related to: ${input}`,
                  },
                ],
                temperature: 0.8,
                max_tokens: 1000,
              }),
            }
          );

          if (!response.ok) throw new Error("Generation failed");

          const data = await response.json();
          const ideas = data.choices[0].message.content
            .split("\n")
            .filter((idea) => idea.trim())
            .slice(0, 4);

          // Update idea cards
          const ideaCards = document.querySelectorAll(".idea-text");
          ideaCards.forEach((card, index) => {
            if (ideas[index]) {
              card.textContent = ideas[index];
            }
          });
        } catch (error) {
          console.error("Error:", error);
          const ideaCards = document.querySelectorAll(".idea-text");
          ideaCards.forEach((card) => {
            card.textContent = "Failed to generate idea. Please try again.";
          });
        }
      }

      // Add this new function
      function useIdea(button) {
        // Get the idea text from the card
        const ideaText = button
          .closest(".idea-card")
          .querySelector(".idea-text").textContent;

        // Switch to post creation section
        const postCreationSection = document.getElementById("post-creation");
        const postInput = document.getElementById("postInput");

        // Update navigation buttons
        document.querySelectorAll(".nav-button").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.getAttribute("data-target") === "post-creation") {
            btn.classList.add("active");
          }
        });

        // Hide all sections and show post creation
        document.querySelectorAll(".content-section").forEach((section) => {
          section.classList.remove("active");
        });
        postCreationSection.classList.add("active");

        // Set the idea text in the post input
        postInput.value = ideaText;

        // Scroll to the top of the post creation section
        postCreationSection.scrollIntoView({ behavior: "smooth" });
      }

      // Add some animation styles
      const style = document.createElement("style");
      style.textContent = `
            .use-button {
                transition: all 0.3s ease;
            }

            .use-button:hover {
                background-color: var(--purple-700);
                transform: translateY(-1px);
            }

            .content-section {
                transition: opacity 0.3s ease;
            }

            .content-section:not(.active) {
                opacity: 0;f
                pointer-events: none;
            }

            .content-section.active {
                opacity: 1;
                pointer-events: auto;
            }
        `;
      document.head.appendChild(style);

      // Initialize saved ideas from localStorage
      let savedIdeas = JSON.parse(localStorage.getItem("savedIdeas")) || [];

      // Function to save idea
      function saveIdea(button) {
        const ideaCard = button.closest(".idea-card");
        const ideaText = ideaCard.querySelector(".idea-text").textContent;

        // Check if idea already exists
        if (!savedIdeas.includes(ideaText)) {
          savedIdeas.push(ideaText);
          localStorage.setItem("savedIdeas", JSON.stringify(savedIdeas));
          updateSavedIdeasDisplay();

          // Show success message
          const saveButton = ideaCard.querySelector(".save-button");
          saveButton.textContent = "Saved ✓";
          saveButton.style.backgroundColor = "#f3f4f6";
          setTimeout(() => {
            saveButton.textContent = "Save";
            saveButton.style.backgroundColor = "white";
          }, 2000);
        }
      }

      // Function to delete saved idea
      function deleteSavedIdea(index) {
        // Show confirmation dialog
        if (confirm("Are you sure you want to delete this idea?")) {
          savedIdeas.splice(index, 1);
          localStorage.setItem("savedIdeas", JSON.stringify(savedIdeas));
          updateSavedIdeasDisplay();

          // Show temporary success message
          const toast = document.createElement("div");
          toast.className = "toast-message";
          toast.textContent = "Idea deleted successfully";
          document.body.appendChild(toast);

          setTimeout(() => {
            toast.remove();
          }, 2000);
        }
      }

      // Function to update saved ideas display
      function updateSavedIdeasDisplay() {
        const savedIdeasGrid = document.querySelector(".saved-ideas-grid");
        savedIdeasGrid.innerHTML = "";

        if (savedIdeas.length === 0) {
          savedIdeasGrid.innerHTML = `
                    <div class="no-saved-ideas">
                        <p>No saved ideas yet. Save some ideas above to see them here!</p>
                    </div>
                `;
          return;
        }

        savedIdeas.forEach((idea, index) => {
          savedIdeasGrid.innerHTML += `
                    <div class="saved-idea-card card">
                        <button onclick="deleteSavedIdea(${index})" class="delete-button" 
                            title="Delete this idea">✕</button>
                        <h3>Saved Idea #${index + 1}</h3>
                        <p class="saved-idea-text">${idea}</p>
                        <div class="idea-actions">
                            <button onclick="useSavedIdea(this)" class="use-button">Use</button>
                        </div>
                    </div>
                `;
        });
      }

      // Call this when the page loads
      document.addEventListener("DOMContentLoaded", function () {
        updateSavedIdeasDisplay();
      });

      function useSavedIdea(button) {
        // Get the idea text from the saved card
        const ideaText = button
          .closest(".saved-idea-card")
          .querySelector(".saved-idea-text").textContent;

        // Switch to post creation section
        const postCreationSection = document.getElementById("post-creation");
        const postInput = document.getElementById("postInput");

        // Update navigation buttons
        document.querySelectorAll(".nav-button").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.getAttribute("data-target") === "post-creation") {
            btn.classList.add("active");
          }
        });

        // Hide all sections and show post creation
        document.querySelectorAll(".content-section").forEach((section) => {
          section.classList.remove("active");
        });
        postCreationSection.classList.add("active");

        // Set the idea text in the post input
        postInput.value = ideaText;

        // Scroll to the top of the post creation section
        postCreationSection.scrollIntoView({ behavior: "smooth" });
      }

      // Add these to your existing JavaScript
      let scheduledPosts =
        JSON.parse(localStorage.getItem("scheduledPosts")) || {};
      let currentDate = new Date();

      function generateCalendar(date) {
        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
        const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
        const startingDay = firstDay.getDay();
        const monthLength = lastDay.getDate();

        const calendarDays = document.getElementById("calendarDays");
        calendarDays.innerHTML = "";

        // Update month display
        document.getElementById("currentMonth").textContent =
          date.toLocaleString("default", { month: "long", year: "numeric" });

        // Add empty cells for days before start of month
        for (let i = 0; i < startingDay; i++) {
          calendarDays.innerHTML += `<div class="calendar-day empty"></div>`;
        }

        // Add days of the month
        for (let day = 1; day <= monthLength; day++) {
          const dateString = `${date.getFullYear()}-${(date.getMonth() + 1)
            .toString()
            .padStart(2, "0")}-${day.toString().padStart(2, "0")}`;
          const scheduledPost = scheduledPosts[dateString];
          const isToday =
            day === new Date().getDate() &&
            date.getMonth() === new Date().getMonth() &&
            date.getFullYear() === new Date().getFullYear();

          calendarDays.innerHTML += `
                    <div class="calendar-day ${
                      scheduledPost ? "has-post" : ""
                    } ${isToday ? "today" : ""}" 
                         onclick="showScheduleModal('${dateString}')">
                        <span class="day-number">${day}</span>
                        ${
                          scheduledPost
                            ? `
                            <div class="post-indicator"></div>
                            <div class="post-time">${formatTime(
                              scheduledPost.time
                            )}</div>
                        `
                            : ""
                        }
                    </div>
                `;
        }
      }

      function showScheduleModal(date) {
        const modal = document.createElement("div");
        const existingPost = scheduledPosts[date];
        const existingTime = existingPost ? existingPost.time : "09:00";
        const existingContent = existingPost ? existingPost.content : "";

        modal.innerHTML = `
                <div class="modal-overlay" onclick="closeModal()"></div>
                <div class="schedule-modal">
                    <div class="modal-header">
                        <h3>Schedule Post</h3>
                        ${
                          existingPost
                            ? `<button onclick="deleteScheduledPost('${date}')" class="delete-button" title="Delete post">
                                <span class="icon">🗑️</span>
                            </button>`
                            : ""
                        }
                    </div>

                    <div class="schedule-inputs">
                        <div class="date-time-selector">
                            <div class="input-group">
                                <label for="postDate">Post Date:</label>
                                <input 
                                    type="date" 
                                    id="postDate" 
                                    value="${date}"
                                    class="date-input"
                                    min="${
                                      new Date().toISOString().split("T")[0]
                                    }"
                                >
                            </div>
                            
                            <div class="input-group">
                                <label for="postTime">Post Time:</label>
                                <input 
                                    type="time" 
                                    id="postTime" 
                                    value="${existingTime}"
                                    class="time-input"
                                >
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="schedulePostContent">Post Content:</label>
                            <textarea 
                                id="schedulePostContent" 
                                placeholder="Enter your post content..."
                                rows="6"
                                class="schedule-textarea"
                            >${existingContent}</textarea>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button onclick="closeModal()" class="cancel-button">Cancel</button>
                        <button onclick="schedulePost()" class="schedule-button">Schedule Post</button>
                    </div>
                </div>
            `;
        document.body.appendChild(modal);
      }

      function closeModal() {
        document.querySelector(".modal-overlay")?.parentElement.remove();
      }

      function schedulePost() {
        const content = document
          .getElementById("schedulePostContent")
          .value.trim();
        const time = document.getElementById("postTime").value;
        const newDate = document.getElementById("postDate").value;

        if (content && time && newDate) {
          // Remove old post if date changed
          const oldDate = Object.keys(scheduledPosts).find(
            (date) => scheduledPosts[date].content === content
          );
          if (oldDate) {
            delete scheduledPosts[oldDate];
          }

          // Save new post
          scheduledPosts[newDate] = {
            content: content,
            time: time,
          };

          // Save to localStorage
          localStorage.setItem(
            "scheduledPosts",
            JSON.stringify(scheduledPosts)
          );

          // Update calendar display
          generateCalendar(new Date(newDate));
          closeModal();

          // Show success message
          const toast = document.createElement("div");
          toast.className = "toast-message";
          toast.textContent = `Post scheduled for ${formatDate(
            newDate
          )} at ${formatTime(time)}`;
          document.body.appendChild(toast);
          setTimeout(() => toast.remove(), 2000);
        } else {
          // Show error if fields are empty
          alert("Please fill in all fields before scheduling");
        }
      }

      function deleteScheduledPost(date) {
        if (confirm("Are you sure you want to delete this scheduled post?")) {
          delete scheduledPosts[date];
          localStorage.setItem(
            "scheduledPosts",
            JSON.stringify(scheduledPosts)
          );
          generateCalendar(currentDate);
          closeModal();

          // Show success message
          const toast = document.createElement("div");
          toast.className = "toast-message";
          toast.textContent = "Post deleted successfully";
          document.body.appendChild(toast);
          setTimeout(() => toast.remove(), 2000);
        }
      }

      function previousMonth() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        generateCalendar(currentDate);
      }

      function nextMonth() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        generateCalendar(currentDate);
      }

      // Initialize calendar when page loads
      document.addEventListener("DOMContentLoaded", function () {
        generateCalendar(currentDate);
      });

      // Add this to your generateWithLlama function
      function scheduleGeneratedPost() {
        const generatedContent =
          document.getElementById("generatedPost").textContent;
        showScheduleModal(new Date().toISOString().split("T")[0]);
        document.getElementById("schedulePostContent").value = generatedContent;
      }

      // Add helper function to format time
      function formatTime(time) {
        return new Date(`2000-01-01T${time}`).toLocaleTimeString([], {
          hour: "numeric",
          minute: "2-digit",
          hour12: true,
        });
      }

      // Helper function to format date
      function formatDate(dateString) {
        return new Date(dateString).toLocaleDateString();
      }

      // PDF.js initialization
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js";

      // File upload handling
      function initializeFileUpload() {
        const dropZone = document.getElementById("dropZone");
        const pdfInput = document.getElementById("pdfInput");

        // Prevent default drag behaviors
        ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
          dropZone.addEventListener(eventName, preventDefaults, false);
          document.body.addEventListener(eventName, preventDefaults, false);
        });

        // Highlight drop zone when dragging over it
        ["dragenter", "dragover"].forEach((eventName) => {
          dropZone.addEventListener(eventName, highlight, false);
        });

        ["dragleave", "drop"].forEach((eventName) => {
          dropZone.addEventListener(eventName, unhighlight, false);
        });

        // Handle dropped files
        dropZone.addEventListener("drop", handleDrop, false);
        pdfInput.addEventListener("change", handleFiles, false);
      }

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      function highlight(e) {
        document.getElementById("dropZone").classList.add("highlight");
      }

      function unhighlight(e) {
        document.getElementById("dropZone").classList.remove("highlight");
      }

      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
      }

      function handleFiles(e) {
        const files = e.target?.files || e;
        if (files[0]) {
          processFile(files[0]);
        }
      }

      async function processFile(file) {
        try {
          const text = await extractTextFromPDF(file);
          await analyzeProfile(text);
        } catch (error) {
          console.error("Error processing file:", error);
          alert("Error processing file. Please try again.");
        }
      }

      async function extractTextFromPDF(file) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let fullText = "";

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          fullText +=
            textContent.items.map((item) => item.str).join(" ") + "\n";
        }

        return fullText;
      }

      async function analyzeProfile(profileText) {
        try {
          const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                model: "llama3-8b-8192",
                messages: [
                    {
                        role: "system",
                        content: `You are a LinkedIn profile analyzer. Respond ONLY with a JSON object in this EXACT format:
{
  "overall": 75,
  "sections": {
    "headline": 70,
    "summary": 75,
    "experience": 80,
    "education": 75,
    "other": 70
  },
  "suggestions": {
    "headline": {
      "current": "Current headline text",
      "improve": "Suggestion for improvement",
      "example": "Example of improved headline"
    },
    "summary": {
      "current": "Current summary text",
      "improve": "Suggestion for improvement",
      "example": "Example of improved summary"
    },
    "experience": {
      "current": "Current experience text",
      "improve": "Suggestion for improvement",
      "example": "Example of improved experience"
    },
    "education": {
      "current": "Current education text",
      "improve": "Suggestion for improvement",
      "example": "Example of improved education"
    },
    "other": {
      "current": "Current other elements",
      "improve": "Suggestion for improvement",
      "example": "Example of improvement"
    }
  }
}`
                    },
                    {
                        role: "user",
                        content: `Analyze this LinkedIn profile and return ONLY the JSON response:\n\n${profileText}`
                    }
                ],
                temperature: 0.3,
                max_tokens: 2000
            })
        });

        if (!response.ok) {
            throw new Error(`API request failed with status ${response.status}`);
        }

        const data = await response.json();
        console.log('Raw API response:', data);

        // Clean the response text
        let analysisText = data.choices[0].message.content
            .trim()
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '') // Remove control characters
            .replace(/\n/g, ' ') // Replace newlines with spaces
            .replace(/\s+/g, ' '); // Replace multiple spaces with single space

        console.log('Cleaned analysis text:', analysisText);

        // Try to extract just the JSON part if there's any extra text
        const jsonMatch = analysisText.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
            analysisText = jsonMatch[0];
        }

        let analysis = JSON.parse(analysisText);
        console.log('Parsed analysis:', analysis);

        // After successfully parsing the analysis, update the UI:
        const analysisResult = document.getElementById('analysisResult');
        analysisResult.innerHTML = `
            <div style="text-align: center; padding: 20px;">
                <h2 style="font-size: 24px; margin-bottom: 20px;">Profile Analysis Score</h2>
                
                <!-- Score Circle -->
                <div style="
                    width: 150px;
                    height: 150px;
                    background-color: #9333ea;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto 30px;
                    color: white;
                    font-size: 24px;
                ">
                    ${analysis.overall}/100
                </div>

                <!-- Section Scores -->
                <div style="margin-top: 30px;">
                    <h2 style="font-size: 24px; margin-bottom: 20px;">Improvement Suggestions</h2>
                    
                    <!-- Suggestions Container -->
                    <div id="suggestionsContainer" style="text-align: left;">
                        ${Object.entries(analysis.suggestions).map(([section, suggestion]) => `
                            <div style="margin-bottom: 20px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                                <div style="background-color: #f3f4f6; padding: 10px; font-weight: bold;">
                                    ${capitalizeFirstLetter(section)}
                                </div>
                                
                                <!-- Current State - Red -->
                                <div style="
                                    background-color: #FEE2E2;
                                    color: #991B1B;
                                    padding: 12px;
                                    border-bottom: 1px solid #e5e7eb;
                                ">
                                    <strong>Current:</strong><br>
                                    ${suggestion.current}
                                </div>

                                <!-- Improvement - Yellow -->
                                <div style="
                                    background-color: #FEF3C7;
                                    color: #92400E;
                                    padding: 12px;
                                    border-bottom: 1px solid #e5e7eb;
                                ">
                                    <strong>Improvement:</strong><br>
                                    ${suggestion.improve}
                                </div>

                                <!-- Example - Green -->
                                <div style="
                                    background-color: #D1FAE5;
                                    color: #065F46;
                                    padding: 12px;
                                ">
                                    <strong>Example:</strong><br>
                                    ${suggestion.example}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;

        // Show the results
        analysisResult.style.display = 'block';

        } catch (error) {
            console.error('Error in analyzeProfile:', error);
            document.getElementById('analysisResult').innerHTML = `
                <div style="color: #DC2626; padding: 12px; background-color: #FEE2E2; border-radius: 6px;">
                    Error analyzing profile: ${error.message}
                    <br><br>
                    Please check:
                    <br>• Your API key is valid
                    <br>• The PDF file contains valid text
                    <br>• Your internet connection is stable
                </div>
            `;
        }
      }

      // Initialize file upload when page loads
      document.addEventListener("DOMContentLoaded", function () {
        initializeFileUpload();
      });

      // Helper function to capitalize first letter
      function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
      }
    </script>
  </body>
</html>
